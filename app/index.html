<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Debugger | AgentCore Multi-Agent Demo</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-brand">
                <div class="logo">üîç</div>
                <div class="header-text">
                    <h1>Error Debugger</h1>
                    <span class="subtitle">Powered by AWS AgentCore ‚Ä¢ 7 Agents ‚Ä¢ 14+ Tools</span>
                </div>
            </div>
            <div class="header-meta">
                <div class="session-info">
                    <span class="label">Session</span>
                    <code id="sessionId">-</code>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Left: Input -->
            <section class="panel input-panel">
                <div class="panel-header">
                    <h2>üì• Paste Your Error</h2>
                    <button class="btn-ghost" id="loadSampleBtn">Load Sample</button>
                </div>
                <div class="panel-body">
                    <!-- GitHub Repo Input -->
                    <div class="github-input">
                        <label for="githubRepo">
                            <span class="github-icon">üîó</span>
                            GitHub Repo (optional - enables code context)
                        </label>
                        <div class="github-input-row">
                            <input 
                                type="text" 
                                id="githubRepo" 
                                placeholder="owner/repo (e.g., facebook/react)"
                                spellcheck="false"
                            />
                            <input 
                                type="text" 
                                id="githubBranch" 
                                placeholder="main"
                                value="main"
                                class="branch-input"
                            />
                        </div>
                        <div class="github-pat-row">
                            <input 
                                type="password" 
                                id="githubPat" 
                                placeholder="PAT (for private repos only)"
                                spellcheck="false"
                            />
                            <button class="btn-ghost btn-sm" id="togglePatBtn" type="button">üëÅ</button>
                        </div>
                        <div class="github-status" id="githubStatus">
                            <span class="hint">üîí PAT stored in memory only, never persisted</span>
                        </div>
                    </div>
                    
                    <textarea 
                        id="errorInput" 
                        placeholder="Paste your error message, stack trace, or exception here...

Example:
TypeError: Cannot read properties of undefined (reading 'map')
    at UserList (src/components/UserList.tsx:15:23)
    at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:14985:18)"
                        spellcheck="false"
                    ></textarea>
                </div>
                <div class="panel-footer">
                    <button class="btn-primary" id="analyzeBtn">
                        <span class="icon">‚ö°</span>
                        <span>Debug Error</span>
                    </button>
                </div>
            </section>

            <!-- Center: Agent Orchestration - Interactive Architecture -->
            <section class="panel orchestration-panel">
                <div class="panel-header">
                    <h2>ü§ñ Live Architecture</h2>
                    <div class="stats">
                        <span id="agentCount">0 agents</span>
                        <span class="divider">‚Ä¢</span>
                        <span id="toolCount">0 tools</span>
                        <span class="divider">‚Ä¢</span>
                        <span id="execTime">0.0s</span>
                        <span class="divider">‚Ä¢</span>
                        <span class="mode-badge" id="modeBadge">DEMO</span>
                    </div>
                </div>
                <div class="panel-body arch-container">
                    <div class="orchestration-empty" id="orchestrationEmpty">
                        <div class="empty-icon">üîç</div>
                        <p>Paste an error and click "Debug Error"</p>
                        <p class="hint">Watch the architecture come alive</p>
                    </div>
                    
                    <div class="arch-diagram" id="archDiagram" style="display: none;">
                        <!-- Clean CSS-based architecture layout -->
                        <div class="arch-layout">
                            <!-- Row 1: User Entry -->
                            <div class="arch-row entry-row">
                                <div class="arch-node frontend" id="node-frontend">
                                    <span class="node-icon">üåê</span>
                                    <span class="node-label">Frontend</span>
                                </div>
                                <span class="arch-arrow">‚Üí</span>
                                <div class="arch-node gateway" id="node-gateway">
                                    <span class="node-icon">‚ö°</span>
                                    <span class="node-label">Gateway</span>
                                    <span class="node-sub">MCP Router</span>
                                </div>
                            </div>
                            
                            <div class="arch-connector vertical">‚Üì</div>
                            
                            <!-- Row 2: Lambda Tools (branching from Gateway) -->
                            <div class="arch-row lambda-row">
                                <div class="arch-node lambda" id="node-parser-lambda">
                                    <span class="node-icon">Œª</span>
                                    <span class="node-label">Parser Lambda</span>
                                </div>
                                <div class="arch-node lambda" id="node-security-lambda">
                                    <span class="node-icon">Œª</span>
                                    <span class="node-label">Security Lambda</span>
                                </div>
                                <span class="arch-arrow">‚Üí</span>
                                <div class="arch-node aws-service" id="node-comprehend">
                                    <span class="node-icon">üìù</span>
                                    <span class="node-label">Comprehend</span>
                                </div>
                            </div>
                            
                            <div class="arch-connector vertical">‚Üì invokes</div>
                            
                            <!-- Row 3: Main Runtime + Services -->
                            <div class="arch-row main-row">
                                <!-- Runtime Container -->
                                <div class="arch-node runtime-container" id="node-runtime">
                                    <div class="runtime-header">
                                        <span class="node-icon">üê≥</span>
                                        <span>Runtime</span>
                                        <span class="runtime-badge">ARM64</span>
                                    </div>
                                    
                                    <!-- Supervisor -->
                                    <div class="agent-node supervisor" id="agent-supervisor">
                                        <span class="agent-icon">üëî</span>
                                        <span class="agent-label">Supervisor</span>
                                        <span class="agent-status" id="supervisorStatus">idle</span>
                                    </div>
                                    
                                    <!-- Agent Grid -->
                                    <div class="agent-grid">
                                        <div class="agent-node" id="agent-parser">
                                            <span class="agent-icon">üìã</span>
                                            <span class="agent-label">Parser</span>
                                            <span class="agent-status" id="parserStatus">idle</span>
                                        </div>
                                        <div class="agent-node" id="agent-security">
                                            <span class="agent-icon">üîí</span>
                                            <span class="agent-label">Security</span>
                                            <span class="agent-status" id="securityStatus">idle</span>
                                        </div>
                                        <div class="agent-node" id="agent-context">
                                            <span class="agent-icon">üåê</span>
                                            <span class="agent-label">Context</span>
                                            <span class="agent-status" id="contextStatus">idle</span>
                                        </div>
                                        <div class="agent-node memory" id="agent-memory">
                                            <span class="agent-icon">üß†</span>
                                            <span class="agent-label">Memory</span>
                                            <span class="agent-status" id="memoryStatus">idle</span>
                                        </div>
                                        <div class="agent-node" id="agent-rootcause">
                                            <span class="agent-icon">üéØ</span>
                                            <span class="agent-label">Root Cause</span>
                                            <span class="agent-status" id="rootcauseStatus">idle</span>
                                        </div>
                                        <div class="agent-node" id="agent-fix">
                                            <span class="agent-icon">üîß</span>
                                            <span class="agent-label">Fix Gen</span>
                                            <span class="agent-status" id="fixStatus">idle</span>
                                        </div>
                                        <div class="agent-node stats" id="agent-stats">
                                            <span class="agent-icon">üìä</span>
                                            <span class="agent-label">Stats</span>
                                            <span class="agent-status" id="statsStatus">idle</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Services Column -->
                                <div class="services-column">
                                    <div class="arch-node aws-service" id="node-bedrock">
                                        <span class="node-icon">ü§ñ</span>
                                        <span class="node-label">Bedrock</span>
                                        <span class="node-sub">Claude 3.5</span>
                                    </div>
                                    <div class="arch-node memory-service" id="node-memory">
                                        <span class="node-icon">üß†</span>
                                        <span class="node-label">Memory</span>
                                        <div class="memory-types-inline">
                                            <span class="mem-badge session" id="mem-session">Session 24h</span>
                                            <span class="mem-badge semantic" id="mem-semantic">Semantic ‚àû</span>
                                        </div>
                                    </div>
                                    <div class="arch-node external" id="node-github">
                                        <span class="node-icon">üêô</span>
                                        <span class="node-label">GitHub</span>
                                        <span class="node-sub">API</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Tool flow explanation -->
                            <div class="arch-flow-note">
                                <span class="flow-step">‚ë† Agents call tools</span>
                                <span class="flow-arrow">‚Üí</span>
                                <span class="flow-step">‚ë° Gateway routes</span>
                                <span class="flow-arrow">‚Üí</span>
                                <span class="flow-step">‚ë¢ Lambda executes</span>
                                <span class="flow-arrow">‚Üí</span>
                                <span class="flow-step">‚ë£ AWS service</span>
                            </div>
                        </div>
                        
                        <!-- Live activity log -->
                        <div class="activity-log" id="activityLog">
                            <div class="log-header">üì° Live Activity</div>
                            <div class="log-entries" id="logEntries">
                                <div class="log-entry placeholder">Waiting for analysis...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right: Results -->
            <section class="panel results-panel">
                <div class="panel-header">
                    <h2>üìä Analysis Results</h2>
                    <button class="btn-icon" id="copyBtn" title="Copy results" disabled>üìã</button>
                </div>
                <div class="panel-body" id="resultsContent">
                    <div class="results-empty">
                        <span class="empty-icon">üìã</span>
                        <p>Results will appear here</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Memory Panel (Bottom) -->
        <section class="panel memory-panel">
            <div class="panel-header">
                <h2>üß† AgentCore Memory</h2>
                <div class="memory-stats">
                    <span class="stat short-term">
                        <span id="shortTermCount">0</span> session
                    </span>
                    <span class="stat long-term">
                        <span id="longTermCount">3</span> patterns
                    </span>
                </div>
            </div>
            <div class="panel-body memory-body">
                <div class="memory-section">
                    <div class="memory-label">
                        <span class="badge short-term">SHORT-TERM</span>
                        <span class="ttl">24hr TTL</span>
                    </div>
                    <div class="memory-list" id="shortTermList">
                        <div class="memory-empty">Session context will appear here</div>
                    </div>
                </div>
                <div class="memory-divider"></div>
                <div class="memory-section">
                    <div class="memory-label">
                        <span class="badge long-term">LONG-TERM</span>
                        <span class="ttl">Persistent</span>
                    </div>
                    <div class="memory-list" id="longTermList">
                        <!-- Pre-seeded patterns will be shown here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- CloudWatch Logs Panel -->
        <section class="panel logs-panel">
            <div class="panel-header">
                <h2>üìã CloudWatch Logs</h2>
                <div class="logs-controls">
                    <span class="logs-status" id="logsStatus">Ready</span>
                    <button class="btn-ghost btn-sm" id="refreshLogsBtn" title="Refresh logs">
                        üîÑ Refresh
                    </button>
                    <button class="btn-ghost btn-sm" id="autoRefreshBtn" title="Toggle auto-refresh">
                        ‚è∏Ô∏è Auto
                    </button>
                </div>
            </div>
            <div class="logs-tabs" id="logsTabs">
                <button class="log-tab active" data-component="all">All</button>
                <button class="log-tab" data-component="runtime">Runtime</button>
                <button class="log-tab" data-component="gateway">Gateway</button>
                <button class="log-tab" data-component="memory">Memory</button>
                <button class="log-tab" data-component="parser">Parser Œª</button>
                <button class="log-tab" data-component="security">Security Œª</button>
                <button class="log-tab" data-component="context">Context Œª</button>
                <button class="log-tab" data-component="stats">Stats Œª</button>
            </div>
            <div class="panel-body logs-body">
                <div class="logs-container" id="logsContainer">
                    <div class="logs-empty">
                        <span class="empty-icon">üìã</span>
                        <p>Click "Refresh" to fetch latest logs</p>
                        <p class="hint">Logs are fetched from CloudWatch</p>
                    </div>
                </div>
            </div>
            <div class="logs-footer">
                <span class="logs-info" id="logsInfo">0 entries</span>
                <span class="logs-filter">
                    <label>
                        <input type="checkbox" id="showErrorsOnly"> Errors only
                    </label>
                </span>
            </div>
        </section>
    </div>

    <!-- 
        AgentCore Configuration
        
        DEPLOYMENT: This entire <script id="agentcore-config"> block should be replaced
        with the actual values from Terraform output "frontend_config".
        
        Example deployment script:
          FRONTEND_CONFIG=$(terraform output -json frontend_config)
          sed -i "s|window.AGENTCORE_CONFIG = {.*};|window.AGENTCORE_CONFIG = ${FRONTEND_CONFIG};|" index.html
        
        LOCAL DEVELOPMENT:
          - demoMode: true  ‚Üí UI testing only (no backend calls)
          - demoMode: false ‚Üí Requires running backend
    -->
    <!-- 
        Production config from Terraform (generated by CI/CD).
        config.js is REQUIRED - it sets window.AGENTCORE_CONFIG with the API endpoint.
    -->
    <script src="config.js" onerror="console.error('‚ùå config.js not found - application will not work without backend configuration')"></script>
    <script id="agentcore-defaults">
        // Verify config is loaded
        if (!window.AGENTCORE_CONFIG) {
            console.error('‚ùå AGENTCORE_CONFIG not set - deploy the application to generate config.js');
            // Minimal fallback to prevent JS errors
            window.AGENTCORE_CONFIG = {
                apiEndpoint: null,
                logsApiEndpoint: null,
                region: 'us-east-1',
                part: 2,
                logGroups: {}
            };
        } else {
            console.log('üöÄ Loaded config.js - API endpoint:', window.AGENTCORE_CONFIG.apiEndpoint);
        }
    </script>
    <script src="app.js"></script>
</body>
</html>

