%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1f26', 'primaryTextColor': '#e7eaed', 'primaryBorderColor': '#58a6ff', 'lineColor': '#58a6ff', 'secondaryColor': '#242b33', 'tertiaryColor': '#2d363f'}}}%%

flowchart TB
    subgraph FRONTEND["ğŸŒ FRONTEND (S3 + CloudFront)"]
        UI["Single Page App<br/>HTML/CSS/JS"]
        CONFIG["config.js<br/>Gateway URL, Runtime ID"]
    end

    subgraph GATEWAY["âš¡ AGENTCORE GATEWAY (MCP Protocol)"]
        GW["Gateway Endpoint<br/>IAM Auth"]
        
        subgraph LAMBDA_TOOLS["ğŸ”§ MCP TOOL LAMBDAS"]
            PARSER_LAMBDA["Parser Lambda<br/>â€¢ Regex extraction<br/>â€¢ Comprehend language<br/>â€¢ Error classification"]
            SECURITY_LAMBDA["Security Lambda<br/>â€¢ Comprehend PII<br/>â€¢ Regex secrets"]
        end
    end

    subgraph RUNTIME["ğŸ³ AGENTCORE RUNTIME (Docker/ARM64)"]
        SUPERVISOR["ğŸ‘” SUPERVISOR AGENT<br/>Orchestrates workflow"]
        
        subgraph AGENTS["Specialist Agents (Strands SDK)"]
            PARSER_AGENT["ğŸ“‹ Parser Agent"]
            SECURITY_AGENT["ğŸ”’ Security Agent"]
            CONTEXT_AGENT["ğŸŒ Context Agent"]
            MEMORY_AGENT["ğŸ§  Memory Agent"]
            ROOTCAUSE_AGENT["ğŸ¯ Root Cause Agent"]
            FIX_AGENT["ğŸ”§ Fix Agent"]
            STATS_AGENT["ğŸ“Š Stats Agent"]
        end
    end

    subgraph MEMORY["ğŸ§  AGENTCORE MEMORY"]
        SESSION["SHORT-TERM<br/>Session Context<br/>TTL: 24h"]
        SEMANTIC["LONG-TERM<br/>Error Patterns<br/>Semantic Search"]
    end

    subgraph BEDROCK["ğŸ¤– AMAZON BEDROCK"]
        CLAUDE["Claude 3 Sonnet<br/>â€¢ Root cause analysis<br/>â€¢ Code fix generation"]
    end

    subgraph COMPREHEND["ğŸ“ AMAZON COMPREHEND"]
        PII["PII Detection"]
        LANG["Language Detection"]
    end

    subgraph EXTERNAL["ğŸŒ EXTERNAL APIs"]
        GITHUB["GitHub API<br/>â€¢ Fetch source code<br/>â€¢ Create issues/PRs"]
        STACKOVERFLOW["Stack Overflow API<br/>â€¢ Related questions"]
    end

    subgraph OBSERVABILITY["ğŸ“Š OBSERVABILITY"]
        XRAY["AWS X-Ray<br/>Distributed Tracing"]
        LOGS["CloudWatch Logs"]
    end

    %% Connections
    UI -->|"HTTPS"| GW
    GW -->|"Invoke Runtime"| SUPERVISOR
    GW -->|"MCP Protocol"| PARSER_LAMBDA
    GW -->|"MCP Protocol"| SECURITY_LAMBDA
    
    SUPERVISOR --> PARSER_AGENT
    SUPERVISOR --> SECURITY_AGENT
    SUPERVISOR --> CONTEXT_AGENT
    SUPERVISOR --> MEMORY_AGENT
    SUPERVISOR --> ROOTCAUSE_AGENT
    SUPERVISOR --> FIX_AGENT
    SUPERVISOR --> STATS_AGENT
    
    PARSER_AGENT -.->|"Tool call"| PARSER_LAMBDA
    SECURITY_AGENT -.->|"Tool call"| SECURITY_LAMBDA
    
    MEMORY_AGENT -->|"Store/Search"| SESSION
    MEMORY_AGENT -->|"Store/Search"| SEMANTIC
    
    ROOTCAUSE_AGENT -->|"InvokeModel"| CLAUDE
    FIX_AGENT -->|"InvokeModel"| CLAUDE
    
    PARSER_LAMBDA --> LANG
    SECURITY_LAMBDA --> PII
    
    CONTEXT_AGENT -->|"HTTP"| GITHUB
    CONTEXT_AGENT -->|"HTTP"| STACKOVERFLOW
    
    RUNTIME --> XRAY
    RUNTIME --> LOGS

